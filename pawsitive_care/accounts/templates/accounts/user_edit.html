{% extends 'accounts/base.html' %}

{% block title %}Edit

{{ user_edit.get_full_name|default:user_edit.username }} - User Management{% endblock %}

{% block content %}
<div class="app-shell" id="appShell">
  <!-- ========= SIDEBAR ========= -->
  <aside class="app-sidebar glass" aria-label="Primary">
    <div class="sidebar-header">
      <button class="sidebar-toggle" type="button" aria-label="Collapse sidebar">
        <i class="fas fa-bars"></i>
      </button>
      <span class="sidebar-title">Admin</span>
    </div>

    <!-- Sections -->
    <nav class="sidebar-nav">
      <div class="sidebar-section">
        <div class="sidebar-section-label">Users</div>
        <a href="{% url 'accounts:user_management' %}" class="sidebar-link">
          <i class="fas fa-users"></i><span>Manage Users</span>
        </a>
        <a href="{% url 'accounts:promote_clients' %}" class="sidebar-link">
          <i class="fas fa-user-plus"></i><span>Promote Clients</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- ========== MAIN CONTENT ========== -->
  <main class="app-main">
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2 class="m-0"><i class="fas fa-edit me-2"></i> Edit User</h2>
            <p class="text-muted mb-0">Update user information and settings</p>
          </div>
          <div class="btn-group" role="group" aria-label="User actions">
            <a href="{% url 'accounts:user_detail' user_edit.id %}" class="btn btn-ghost">
              <i class="fas fa-eye me-1"></i> View Details
            </a>
            <a href="{% url 'accounts:user_management' %}" class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left me-1"></i> Back to Users
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Form -->
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card glass">
          <div class="card-header">
            <h5 class="m-0"><i class="fas fa-user me-2"></i>
              {{ user_edit.get_full_name|default:user_edit.username }}
            </h5>
          </div>
          <div class="card-body">
            <form method="post">
              {% csrf_token %}

              <!-- Personal Information -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="border-bottom pb-2 mb-3">Personal Information</h6>
                </div>
                <div class="col-md-6">
                  <label for="first_name" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user_edit.first_name }}" placeholder="Enter first name">
                </div>
                <div class="col-md-6">
                  <label for="last_name" class="form-label">Last Name</label>
                  <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user_edit.last_name }}" placeholder="Enter last name">
                </div>
                <div class="col-md-6">
                  <label for="email" class="form-label">Email Address</label>
                  <input type="email" class="form-control" id="email" name="email" value="{{ user_edit.email }}" placeholder="Enter email address">
                </div>
                <div class="col-md-6">
                  <label for="phone" class="form-label">Phone Number</label>
                  <input type="tel" class="form-control" id="phone" name="phone" value="{{ user_edit.phone }}" placeholder="Enter phone number">
                </div>
              </div>

              <!-- Account Settings -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="border-bottom pb-2 mb-3">Account Settings</h6>
                </div>
                <div class="col-md-6">
                  <label for="role" class="form-label">Role</label>
                  <select class="form-select" id="role" name="role">
                    {% for role_code, role_name in role_choices %}
                    <option value="{{ role_code }}" {% if user_edit.role == role_code %}selected{% endif %}>
                      {{ role_name }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Account Status</label>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if user_edit.is_active %}checked{% endif %}>
                    <label class="form-check-label" for="is_active">
                      Active Account
                    </label>
                  </div>
                  <small class="form-text text-muted">
                    Unchecking this will disable the user's account
                  </small>
                </div>
              </div>

              <!-- Account Information (Read-only) -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="border-bottom pb-2 mb-3">Account Information</h6>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Username</label>
                  <input type="text" class="form-control" value="{{ user_edit.username }}" readonly>
                  <small class="form-text text-muted">Username cannot be changed</small>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Date Joined</label>
                  <input type="text" class="form-control" value="{{ user_edit.date_joined|date:'F d, Y' }}" readonly>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last Login</label>
                  <input type="text" class="form-control" value="{% if user_edit.last_login %}{{ user_edit.last_login|date:'F d, Y g:i A' }}{% else %}Never{% endif %}" readonly>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="d-flex justify-content-end gap-2">
                <a href="{% url 'accounts:user_detail' user_edit.id %}" class="btn btn-secondary">
                  <i class="fas fa-times me-1"></i> Cancel
                </a>
                <button type="submit" class="btn btn-accent">
                  <i class="fas fa-save me-1"></i> Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
{% endblock %}