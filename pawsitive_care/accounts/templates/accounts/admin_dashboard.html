{% extends 'accounts/base.html' %}

{% block title %}Admin Dashboard - Pawsitive Care{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- Admin Header -->
  <div class="row mb-5">
    <div class="col-12">
      <div class="admin-header glass-effect p-4 rounded-4">
        <div class="d-flex justify-content-between align-items-center">
          <div class="fade-in-up">
            <h1 class="display-6 fw-bold mb-2">
              <i class="fas fa-user-shield me-3" style="color: var(--danger-accent);"></i>
              Administrator Dashboard
            </h1>
            <p class="lead text-muted mb-0">Manage your veterinary clinic system</p>
          </div>
          <div class="slide-in-right">
            <span class="role-badge fs-6" style="background: linear-gradient(135deg, var(--danger-accent), #dc2626);">
              {{ user.get_role_display }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- System Stats Overview -->
  <div class="row g-4 mb-5">
    <div class="col-md-6 col-lg-3">
      <div class="stats-card fade-in-up" style="animation-delay: 0.1s;">
        <div class="stats-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ stats.total_users }}</h3>
          <p class="stats-label">Total Users</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stats-card fade-in-up" style="animation-delay: 0.2s;">
        <div class="stats-icon">
          <i class="fas fa-blog"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ blog_stats.total_posts }}</h3>
          <p class="stats-label">Blog Posts</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stats-card fade-in-up" style="animation-delay: 0.3s;">
        <div class="stats-icon">
          <i class="fas fa-boxes"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ inventory_stats.total_items }}</h3>
          <p class="stats-label">Inventory Items</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stats-card fade-in-up" style="animation-delay: 0.4s;">
        <div class="stats-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stats-content">
          <h3 class="stats-number">{{ inventory_stats.low_stock_items }}</h3>
          <p class="stats-label">Low Stock Alerts</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Management Sections -->
  <div class="row g-4 mb-5">
    <!-- User Management -->
    <div class="col-lg-4">
      <div class="card h-100 fade-in-up" style="animation-delay: 0.5s;">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-users-cog me-2" style="color: var(--primary-accent);"></i>
            User Management
          </h5>
        </div>
        <div class="card-body">
          <div class="management-grid">
            <a href="{% url 'accounts:user_management' %}" class="management-item">
              <i class="fas fa-cog"></i>
              <span>Manage Users</span>
            </a>
            <a href="{% url 'accounts:promote_clients' %}" class="management-item">
              <i class="fas fa-arrow-up"></i>
              <span>Promote Users</span>
            </a>
          </div>
          
          <div class="user-stats mt-4">
            <div class="stat-row">
              <span>Administrators</span>
              <span class="badge bg-danger">{{ stats.admin_count }}</span>
            </div>
            <div class="stat-row">
              <span>Veterinarians</span>
              <span class="badge bg-success">{{ stats.vet_count }}</span>
            </div>
            <div class="stat-row">
              <span>Staff Members</span>
              <span class="badge bg-warning">{{ stats.staff_count }}</span>
            </div>
            <div class="stat-row">
              <span>Clients</span>
              <span class="badge bg-info">{{ stats.client_count }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Inventory Management -->
    <div class="col-lg-4">
      <div class="card h-100 fade-in-up" style="animation-delay: 0.6s;">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-boxes me-2" style="color: var(--warning-accent);"></i>
            Inventory Management
          </h5>
        </div>
        <div class="card-body">
          <div class="inventory-overview mb-4">
            <div class="row g-3">
              <div class="col-6">
                <div class="metric-card text-center">
                  <i class="fas fa-box text-primary"></i>
                  <h4 class="mt-2">{{ inventory_stats.total_items|default:0 }}</h4>
                  <small class="text-muted">Total Items</small>
                </div>
              </div>
              <div class="col-6">
                <div class="metric-card text-center">
                  <i class="fas fa-exclamation-triangle text-warning"></i>
                  <h4 class="mt-2">{{ inventory_stats.low_stock_items|default:0 }}</h4>
                  <small class="text-muted">Low Stock</small>
                </div>
              </div>
            </div>
          </div>
          
          <div class="d-grid gap-2">
            <a href="{% url 'inventory:item_list' %}" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-list me-2"></i>View All Items
            </a>
            <a href="{% url 'inventory:item_create' %}" class="btn btn-outline-success btn-sm">
              <i class="fas fa-plus me-2"></i>Add New Item
            </a>
            <a href="{% url 'inventory:item_list' %}?low_stock=1" class="btn btn-outline-warning btn-sm">
              <i class="fas fa-exclamation-triangle me-2"></i>Low Stock Alerts
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Blog Management -->
    <div class="col-lg-4">
      <div class="card h-100 fade-in-up" style="animation-delay: 0.7s;">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-blog me-2" style="color: var(--secondary-accent);"></i>
            Blog Management
          </h5>
        </div>
        <div class="card-body">
          <div class="blog-stats mb-4">
            <div class="row g-2">
              <div class="col-6">
                <div class="metric-card text-center">
                  <h5 class="text-success">{{ blog_stats.published_posts }}</h5>
                  <small class="text-muted">Published</small>
                </div>
              </div>
              <div class="col-6">
                <div class="metric-card text-center">
                  <h5 class="text-warning">{{ blog_stats.unpublished_posts }}</h5>
                  <small class="text-muted">Drafts</small>
                </div>
              </div>
            </div>
          </div>
          
          <div class="d-grid gap-2">
            <a href="/admin/petmedia/blogpost/" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-cog me-2"></i>Manage Posts
            </a>
            <a href="/admin/petmedia/blogcomment/" class="btn btn-outline-success btn-sm">
              <i class="fas fa-comments me-2"></i>Review Comments
            </a>
            <a href="/admin/petmedia/blogpost/?is_featured__exact=1" class="btn btn-outline-warning btn-sm">
              <i class="fas fa-crown me-2"></i>Featured Content
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card fade-in-up" style="animation-delay: 0.8s;">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-activity me-2" style="color: var(--success-accent);"></i>
            Recent System Activity
          </h5>
        </div>
        <div class="card-body">
          <div class="activity-feed">
            {% for user in recent_users %}
            <div class="activity-item d-flex justify-content-between align-items-center p-3 mb-3 rounded-3" style="background: var(--tertiary-bg);">
              <div class="d-flex align-items-center">
                <div class="activity-icon me-3">
                  <i class="fas fa-user-plus text-success"></i>
                </div>
                <div>
                  <p class="mb-1">New user registration</p>
                  <h6 class="mb-0">{{ user.get_full_name|default:user.username }}</h6>
                  <small class="text-muted">({{ user.get_role_display }})</small>
                </div>
              </div>
              <small class="text-muted">{{ user.date_joined|timesince }} ago</small>
            </div>
            {% empty %}
            <div class="text-center py-4">
              <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
              <p class="text-muted mb-0">No recent user activity</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card fade-in-up" style="animation-delay: 0.9s;">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-blog me-2" style="color: var(--secondary-accent);"></i>
            Recent Blog Activity
          </h5>
        </div>
        <div class="card-body">
          <div class="blog-feed">
            {% for post in recent_posts %}
            <div class="blog-item d-flex justify-content-between align-items-start p-3 mb-3 rounded-3" style="background: var(--tertiary-bg);">
              <div class="flex-grow-1">
                <div class="d-flex align-items-center mb-2">
                  {% if post.is_professional_advice %}
                  <i class="fas fa-user-md text-success me-2"></i>
                  {% else %}
                  <i class="fas fa-edit text-primary me-2"></i>
                  {% endif %}
                  <div>
                    <a href="/admin/petmedia/blogpost/{{ post.id }}/change/" class="text-decoration-none text-white">
                      {{ post.title|truncatechars:40 }}
                    </a>
                    <small class="d-block text-muted">
                      by {{ post.author.get_full_name|default:post.author.username }}
                    </small>
                  </div>
                </div>
              </div>
              <div class="text-end">
                {% if post.is_published %}
                <span class="badge bg-success">Published</span>
                {% else %}
                <span class="badge bg-warning">Draft</span>
                {% endif %}
                <small class="d-block text-muted mt-1">
                  {{ post.created_at|timesince }} ago
                </small>
              </div>
            </div>
            {% empty %}
            <div class="text-center py-4">
              <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
              <p class="text-muted mb-0">No recent blog posts</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .admin-header {
    background: linear-gradient(135deg, var(--secondary-bg), var(--tertiary-bg));
    border: 1px solid var(--border-color);
  }

  .stats-card {
    background: var(--secondary-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-xl);
    padding: 2rem;
    text-align: center;
    transition: var(--transition-normal);
    position: relative;
    overflow: hidden;
    height: 100%;
  }

  .stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-accent), var(--secondary-accent));
    opacity: 0;
    transition: var(--transition-normal);
  }

  .stats-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--border-hover);
  }

  .stats-card:hover::before {
    opacity: 1;
  }

  .stats-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-accent), var(--secondary-accent));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 2rem;
    color: white;
  }

  .stats-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-text);
    margin-bottom: 0.5rem;
  }

  .stats-label {
    color: var(--secondary-text);
    font-weight: 500;
    margin-bottom: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.875rem;
  }

  .management-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .management-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    background: var(--tertiary-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-md);
    text-decoration: none;
    color: var(--primary-text);
    transition: var(--transition-fast);
    gap: 1rem;
  }

  .management-item:hover {
    background: var(--accent-bg);
    border-color: var(--border-hover);
    color: var(--primary-text);
    transform: translateX(4px);
  }

  .management-item i {
    font-size: 1.25rem;
    color: var(--primary-accent);
  }

  .user-stats {
    background: var(--tertiary-bg);
    border-radius: var(--border-radius-md);
    padding: 1rem;
  }

  .stat-row {
    display: flex;
    justify-content: between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
  }

  .stat-row:last-child {
    border-bottom: none;
  }

  .metric-card {
    background: var(--tertiary-bg);
    border-radius: var(--border-radius-md);
    padding: 1rem;
    border: 1px solid var(--border-color);
    transition: var(--transition-fast);
  }

  .metric-card:hover {
    background: var(--accent-bg);
    transform: translateY(-2px);
  }

  .activity-item:hover {
    background: var(--accent-bg) !important;
    transform: translateX(4px);
  }

  .blog-item:hover {
    background: var(--accent-bg) !important;
    transform: translateX(4px);
  }

  /* Enhanced responsive design */
  @media (max-width: 768px) {
    .stats-card {
      padding: 1.5rem;
    }
    
    .stats-icon {
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
    }
    
    .stats-number {
      font-size: 2rem;
    }
    
    .admin-header .d-flex {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
  }
</style>
{% endblock %}