{% extends 'accounts/base.html' %}

{% block title %}Staff Dashboard - Pawsitive Care{% endblock %}

{% block content %}
<div class="app-shell">
  {# ============== LEFT SIDEBAR ============== #}
  <aside class="app-sidebar glass" aria-label="Primary">
    <div class="sidebar-header">
      <button class="sidebar-toggle" type="button" aria-label="Collapse sidebar">
        <i class="fas fa-bars"></i>
      </button>
      <span class="sidebar-title">Staff</span>
    </div>

    <nav class="sidebar-nav">
      <div class="sidebar-section">
        <div class="sidebar-section-label">Overview</div>
        <a href="{% url 'accounts:staff_dashboard' %}" class="sidebar-link {% if request.resolver_match.url_name == 'staff_dashboard' %}active{% endif %}">
          <i class="fas fa-user-tie"></i><span>Dashboard</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-label">Appointments</div>
        <a href="{% url 'appointments:create_appointment' %}" class="sidebar-link">
          <i class="fas fa-calendar-plus"></i><span>New Appointment</span>
        </a>
        <a href="{% url 'appointments:staff_calendar' %}" class="sidebar-link">
          <i class="fas fa-calendar-alt"></i><span>Staff Calendar</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-label">Clients</div>
        <a href="{% url 'pets:search_page' %}" class="sidebar-link">
          <i class="fas fa-search"></i><span>Find Pet</span>
        </a>
        <a href="{% url 'pets:pet_list' %}" class="sidebar-link">
          <i class="fas fa-paw"></i><span>All Pets</span>
        </a>
        <a href="{% url 'accounts:user_management' %}" class="sidebar-link">
          <i class="fas fa-users"></i><span>Client Management</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-label">Communication</div>
        <a href="{% url 'communication:communication_list' %}" class="sidebar-link">
          <i class="fas fa-comments"></i><span>Messages</span>
        </a>
        <a href="{% url 'petmedia:blog_list' %}" class="sidebar-link">
          <i class="fas fa-blog"></i><span>Blog Posts</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-label">Billing</div>
        <a href="{% url 'billing:view_bills' %}" class="sidebar-link">
          <i class="fas fa-receipt"></i><span>View Bills</span>
        </a>
        <a href="{% url 'billing:add_bill' %}" class="sidebar-link">
          <i class="fas fa-plus"></i><span>Create Bill</span>
        </a>
        <a href="{% url 'billing:servicecost_list' %}" class="sidebar-link">
          <i class="fas fa-dollar-sign"></i><span>Service Costs</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-label">Inventory</div>
        <a href="{% url 'inventory:dashboard' %}" class="sidebar-link">
          <i class="fas fa-tachometer-alt"></i><span>Inventory Dashboard</span>
        </a>
        <a href="{% url 'inventory:item_create' %}" class="sidebar-link">
          <i class="fas fa-plus"></i><span>Add Item</span>
        </a>
        <a href="{% url 'inventory:item_list' %}" class="sidebar-link">
          <i class="fas fa-boxes"></i><span>All Items</span>
        </a>
        <a href="{% url 'inventory:item_list' %}?low_stock=1" class="sidebar-link">
          <i class="fas fa-triangle-exclamation"></i><span>Low Stock</span>
        </a>
        <a href="{% url 'inventory:reports' %}" class="sidebar-link">
          <i class="fas fa-chart-bar"></i><span>Reports</span>
        </a>
      </div>
    </nav>
  </aside>

  {# ============== MAIN ============== #}
  <main class="app-main">
    <!-- Page header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2><i class="fas fa-user-tie me-2 themed-icon"></i> Staff Dashboard</h2>
        <p class="text-muted">Manage appointments and client services</p>
      </div>

    </div>

    <!-- Left content + Right sticky rail -->
    <div class="main-grid">
      <!-- LEFT: main content -->
      <section class="main-content">

        <!-- Today's Schedule -->
        <div class="card glass card-olive mb-4">
          <div class="card-header soft-accent-bg">
            <h5 class="m-0"><i class="fas fa-list me-2 themed-icon"></i> Today's Schedule</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Client</th>
                    <th>Pet</th>
                    <th>Veterinarian</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% if todays_appointments %}
                  {% for appointment in todays_appointments %}
                  <tr>
                    <td><strong>
                        {{ appointment.time|time:"g:i A" }}</strong></td>
                    <td>
                      {{ appointment.client.get_full_name|default:appointment.client.username }}
                    </td>
                    <td>
                      {{ appointment.pet.name }} (
                      {{ appointment.pet.get_species_display }})
                    </td>
                    <td>Dr.
                      {{ appointment.vet.get_full_name|default:appointment.vet.username }}
                    </td>
                    <td>
                      {% if appointment.status == 'COMPLETED' %}
                      <span class="badge badge-solid">Completed</span>
                      {% elif appointment.status == 'SCHEDULED' %}
                      <span class="badge badge-outline">Scheduled</span>
                      {% elif appointment.status == 'PENDING' %}
                      <span class="badge badge-outline">Waiting</span>
                      {% else %}
                      <span class="badge badge-outline">
                        {{ appointment.get_status_display }}</span>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                  {% else %}
                  <tr>
                    <td colspan="5" class="text-center py-4">
                      <i class="fas fa-calendar-times fa-2x text-muted mb-2"></i>
                      <p class="text-muted mb-0">No appointments scheduled for today</p>
                    </td>
                  </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </div>
        </div>


        <!-- Quick actions row (cards) -->
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card glass card-teal h-100">
              <div class="card-header soft-accent-bg">
                <h6 class="m-0"><i class="fas fa-chart-line me-2 themed-icon"></i> This Week's Stats</h6>
              </div>
              <div class="card-body">
                <div class="row text-center">
                  <div class="col-4">
                    <h4 class="solid-accent-text">
                      {{ weekly_stats.appointments_this_week|default:0 }}
                    </h4>
                    <small>Appointments</small>
                  </div>
                  <div class="col-4">
                    <h4 class="solid-accent-text">
                      {{ weekly_stats.completed_appointments|default:0 }}
                    </h4>
                    <small>Completed</small>
                  </div>
                  <div class="col-4">
                    <h4 class="solid-accent-text">
                      {{ weekly_stats.new_clients_this_week|default:0 }}
                    </h4>
                    <small>New Clients</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 mb-4">
            <div class="card glass hover-lift h-100 card-amber">
              <div class="card-body text-center">
                <i class="fas fa-calendar-check fa-2x themed-icon mb-3"></i>
                <h5>Appointments</h5>
                <p class="text-muted">Schedule & manage</p>
                <div class="d-grid gap-2">
                  <a href="{% url 'appointments:create_appointment' %}" class="btn btn-accent btn-sm">
                    <i class="fas fa-plus me-1"></i> New Appointment
                  </a>
                  <a href="{% url 'appointments:staff_calendar' %}" class="btn btn-ghost btn-sm">
                    <i class="fas fa-calendar me-1"></i> View Calendar
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 mb-4">
            <div class="card glass hover-lift h-100 card-indigo">
              <div class="card-body text-center">
                <i class="fas fa-users fa-2x themed-icon mb-3"></i>
                <h5>Clients</h5>
                <p class="text-muted">Manage client info</p>
                <div class="d-grid gap-2">
                  <a href="{% url 'pets:search_page' %}" class="btn btn-accent btn-sm">
                    <i class="fas fa-search me-1"></i> Find Pet
                  </a>
                  <a href="{% url 'accounts:user_management' %}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-users me-1"></i> Manage Clients
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 mb-4">
            <div class="card glass hover-lift h-100 card-success">
              <div class="card-body text-center">
                <i class="fas fa-comments fa-2x themed-icon mb-3"></i>
                <h5>Communication</h5>
                <p class="text-muted">Messages & updates</p>
                <div class="d-grid gap-2">
                  <a href="{% url 'communication:communication_list' %}" class="btn btn-accent btn-sm">
                    <i class="fas fa-comments me-1"></i> Messages
                  </a>
                  <a href="{% url 'petmedia:blog_list' %}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-blog me-1"></i> Blog Posts
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 mb-4">
            <div class="card glass hover-lift h-100 card-olive">
              <div class="card-body text-center">
                <i class="fas fa-dollar-sign fa-2x themed-icon mb-3"></i>
                <h5>Service Cost</h5>
                <p class="text-muted">Manage Service Cost List</p>
                <a href="{% url 'billing:servicecost_list' %}" class="btn btn-accent btn-sm">
                  <i class="fas fa-list me-1"></i> Open List
                </a>
              </div>
            </div>
          </div>

          <div class="col-md-3 mb-4">
            <div class="card glass hover-lift h-100 card-primary card-sienna">
              <div class="card-body text-center">
                <i class="fas fa-receipt fa-2x themed-icon mb-3"></i>
                <h5>Billing</h5>
                <p class="text-muted">Process payments</p>
                <div class="d-grid gap-2">
                  <a href="{% url 'billing:view_bills' %}" class="btn btn-accent btn-sm">
                    <i class="fas fa-receipt me-1"></i> View Bills
                  </a>
                  <a href="{% url 'billing:add_bill' %}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-plus me-1"></i> Create Bill
                  </a>
                </div>
              </div>
            </div>
          </div>


        </div>

        <div class="row mb-4">
          <div class="col-12">
            <div class="card glass h-100 card-amber">
              <div class="card-header soft-accent-bg">
                <h6 class="mb-0"><i class="fas fa-tasks me-2 themed-icon"></i> Quick Inventory Actions</h6>
              </div>
              <div class="card-body">
                <div class="row g-2">
                  <div class="col-md-6">
                    <a href="{% url 'inventory:item_create' %}" class="btn btn-accent btn-sm w-100">
                      <i class="fas fa-plus me-1"></i> Add New Item
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'inventory:item_list' %}" class="btn btn-ghost btn-sm w-100">
                      <i class="fas fa-list me-1"></i> View All Items
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'inventory:item_list' %}?low_stock=1" class="btn btn-ghost btn-sm w-100">
                      <i class="fas fa-triangle-exclamation me-1"></i> Low Stock Alert
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'inventory:reports' %}" class="btn btn-ghost btn-sm w-100">
                      <i class="fas fa-chart-bar me-1"></i> Reports
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>




      </section>

      <!-- RIGHT: sticky rail -->
      <aside class="right-rail">
        <div class="card glass card-rose">
          <div class="card-header soft-accent-bg">
            <h5 class="m-0"><i class="fas fa-tasks me-2 themed-icon"></i> Daily Tasks</h5>
          </div>
          <div class="card-body">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" checked>
              <label class="form-check-label">Confirm tomorrow's appointments</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox">
              <label class="form-check-label">Update client contact info</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox">
              <label class="form-check-label">Process payment receipts</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" checked>
              <label class="form-check-label">Inventory supply check</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox">
              <label class="form-check-label">File medical records</label>
            </div>
          </div>
        </div>

        <div class="card glass card-indigo mt-3">
          <div class="card-header soft-accent-bg">
            <h5 class="m-0"><i class="fas fa-bell me-2 themed-icon"></i> Notifications</h5>
          </div>
          <div class="card-body">
            <ul class="list-unstyled m-0">
              {% if inventory_stats.low_stock_items > 0 %}
              <li class="mb-2 small"><i class="fas fa-triangle-exclamation me-2"></i>
                {{ inventory_stats.low_stock_items }} items low in stock
              </li>
              {% endif %}
              {% if billing_stats.pending_bills > 0 %}
              <li class="mb-2 small"><i class="fas fa-triangle-exclamation me-2"></i>
                {{ billing_stats.pending_bills }} pending bills
              </li>
              {% endif %}
              {% if weekly_stats.appointments_this_week > 0 %}
              <li class="small"><i class="fas fa-check-circle me-2"></i>
                {{ weekly_stats.appointments_this_week }} appointments this week
              </li>
              {% endif %}
              {% if not inventory_stats.low_stock_items and not billing_stats.pending_bills %}
              <li class="small text-muted"><i class="fas fa-check-circle me-2"></i> All systems operating normally</li>
              {% endif %}
            </ul>
          </div>
        </div>

        <div class="card glass card-teal mt-3">
          <div class="card-header soft-accent-bg">
            <h6 class="mb-0"><i class="fas fa-boxes me-2 themed-icon"></i> Inventory Overview</h6>
          </div>
          <div class="card-body">
            <div class="row g-2 mb-3 text-center">
              <div class="col-6">
                <i class="fas fa-box fa-2x themed-icon"></i>
                <div class="h5 mb-0 mt-1">
                  {{ inventory_stats.total_items|default:0 }}
                </div>
                <div class="small text-muted">Total Items</div>
              </div>
              <div class="col-6">
                <i class="fas fa-triangle-exclamation fa-2x themed-icon"></i>
                <div class="h5 mb-0 mt-1">
                  {{ inventory_stats.low_stock_items|default:0 }}
                </div>
                <div class="small text-muted">Low Stock</div>
              </div>
            </div>
            <a href="{% url 'inventory:dashboard' %}" class="btn btn-ghost btn-sm w-100">
              <i class="fas fa-tachometer-alt me-1"></i> View Inventory
            </a>
          </div>

      </aside>
    </div>
  </main>
</div>
{% endblock %}